"use strict";Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const K=require("@nhost/nhost-js"),E=require("react"),s=require("@xstate/react"),q=require("immer"),y=require("@nhost/core"),F=require("jwt-decode"),U=require("@nhost/hasura-storage-js"),w=e=>e&&typeof e=="object"&&"default"in e?e:{default:e},v=w(E),j=w(q),H=w(F);class J extends K.NhostClient{constructor(t){super({...t,start:!1})}}const P=E.createContext({}),Q=({nhost:e,initial:t,...n})=>{const u=e.auth.client.machine,h=s.useInterpret(u,{devTools:e.devTools,context:j.default(u.context,a=>{var S,m;t&&(a.user=t.user,a.refreshToken.value=(S=t.refreshToken)!=null?S:null,a.accessToken.value=(m=t.accessToken)!=null?m:null,a.accessToken.expiresAt=new Date(Date.now()+t.accessTokenExpiresIn*1e3))})}).start(),d=E.useRef(!0);return E.useEffect(()=>{d.current?d.current=!1:t&&h.send("SESSION_UPDATE",{data:{session:t}})},[t,h]),e.auth.client.interpreter=h,v.default.createElement(P.Provider,{value:e},n.children)},I=()=>{var n;const t=(n=E.useContext(P).auth)==null?void 0:n.client.interpreter;if(!t)throw Error("No interpreter");return t},A=()=>{const e=I();return s.useSelector(e,t=>({isAuthenticated:t.matches({authentication:"signedIn"}),isLoading:t.hasTag("loading"),error:t.context.errors.authentication||null,isError:t.matches({authentication:{signedOut:"failed"}}),connectionAttempts:t.context.importTokenAttempts}),(t,n)=>t.isAuthenticated===n.isAuthenticated&&t.isLoading===n.isLoading&&t.connectionAttempts===n.connectionAttempts)};function $({children:e}){const{isAuthenticated:t}=A();return t?v.default.createElement(v.default.Fragment,null,e):null}function B({children:e}){const{isAuthenticated:t}=A();return t?null:v.default.createElement(v.default.Fragment,null,e)}const k=()=>{const e=I();return s.useSelector(e,t=>t.context.accessToken.value)},x=()=>E.useContext(P),G=()=>{const e=x(),[t,n]=E.useState(null),u=!t,h=!!t,[d,a]=E.useState(!1);return{add:async m=>{a(!0);const o=await y.addSecurityKeyPromise(e.auth.client,m),{error:r}=o;return r&&n(r),a(!1),o},isLoading:d,isSuccess:u,isError:h,error:t}},W=()=>{const e=I(),[t,n]=E.useState(!!e.status&&e.getSnapshot().matches({authentication:"signedIn"}));return E.useEffect(()=>e.subscribe(h=>{const d=h.matches({authentication:"signedIn"});n(d)}).unsubscribe,[e]),t},Y=()=>{const e=I();return s.useSelector(e,t=>t.hasTag("loading"))};function z(e,t){const n=E.useMemo(()=>typeof e=="string"?e:void 0,[e]),u=E.useMemo(()=>typeof e!="string"?e:t,[e,t]),h=x(),d=E.useMemo(()=>y.createChangeEmailMachine(h.auth.client),[h]),a=s.useInterpret(d),S=s.useSelector(a,i=>i.matches("requesting")),m=s.useSelector(a,i=>i.context.error),o=s.useSelector(a,i=>i.matches("idle.error")),r=s.useSelector(a,i=>i.matches("idle.success"));return{changeEmail:E.useCallback(async(i,g=u)=>y.changeEmailPromise(a,typeof i=="string"?i:n,g),[a,n,u]),isLoading:S,needsEmailVerification:r,isError:o,error:m}}const X=e=>{const t=x(),n=E.useMemo(()=>y.createChangePasswordMachine(t.auth.client),[t]),u=s.useInterpret(n),h=s.useSelector(u,o=>o.matches({idle:"error"})),d=s.useSelector(u,o=>o.matches({idle:"success"})),a=s.useSelector(u,o=>o.context.error),S=s.useSelector(u,o=>o.matches("requesting"));return{changePassword:o=>y.changePasswordPromise(u,typeof o=="string"?o:e),isLoading:S,isSuccess:d,isError:h,error:a}},Z=()=>{const e=x(),t=E.useMemo(()=>y.createEnableMfaMachine(e.auth.client),[e]),n=s.useInterpret(t),u=s.useSelector(n,i=>i.matches({idle:"error"})||i.matches({generated:{idle:"error"}})),h=s.useSelector(n,i=>i.matches("generating")),d=s.useSelector(n,i=>i.matches("generated")),a=s.useSelector(n,i=>i.matches({generated:"activating"})),S=s.useSelector(n,i=>i.matches({generated:"activated"})),m=s.useSelector(n,i=>i.context.error),o=s.useSelector(n,i=>i.context.imageUrl||"");return{generateQrCode:()=>y.generateQrCodePromise(n),isGenerating:h,qrCodeDataUrl:o,isGenerated:d,activateMfa:i=>y.activateMfaPromise(n,i),isActivating:a,isActivated:S,isError:u,error:m}},C=()=>{const e=k();return e?H.default(e):null},T=e=>{const t=x(),n=p=>{e.send({type:"ADD",file:p.file,bucketId:p.bucketId||i})},u=p=>U.uploadFilePromise(t,e,{file:p.file,bucketId:p.bucketId||i,id:l,name:g}),h=()=>{e.send("CANCEL")},d=()=>{e.send("DESTROY")},a=s.useSelector(e,p=>p.matches("uploading")),S=s.useSelector(e,p=>p.matches("uploaded")),m=s.useSelector(e,p=>p.matches("error")),o=s.useSelector(e,p=>p.context.error||null),r=s.useSelector(e,p=>p.context.progress),l=s.useSelector(e,p=>p.context.id),i=s.useSelector(e,p=>p.context.bucketId),g=s.useSelector(e,p=>{var c;return(c=p.context.file)==null?void 0:c.name});return{add:n,upload:u,cancel:h,destroy:d,isUploaded:S,isUploading:a,isError:m,error:o,progress:r,id:l,bucketId:i,name:g}},b=()=>{const e=s.useInterpret(U.createFileUploadMachine);return T(e)},O=()=>{const e=C();return(e==null?void 0:e["https://hasura.io/jwt/claims"])||null},ee=e=>{const t=O();return(t==null?void 0:t[e.startsWith("x-hasura-")?e:`x-hasura-${e}`])||null},te=()=>{const e=x(),[t,n]=E.useState([]),u=s.useInterpret(U.createMultipleFilesUploadMachine,{},g=>{g.event.type==="UPLOAD_ERROR"?n(g.context.files.filter(p=>{var c;return(c=p.getSnapshot())==null?void 0:c.context.error})):(g.matches("uploaded")||g.event.type==="CLEAR")&&t.length>0&&n([])}),h=g=>{u.send({type:"ADD",...g})},d=g=>U.uploadMultipleFilesPromise(e,u,g),a=()=>{u.send("CANCEL")},S=()=>{u.send("CLEAR")},m=s.useSelector(u,g=>g.matches("uploading")),o=s.useSelector(u,g=>g.matches("uploaded")),r=s.useSelector(u,g=>g.matches("error")),l=s.useSelector(u,g=>g.context.progress),i=s.useSelector(u,g=>g.context.files);return{upload:d,add:h,clear:S,cancel:a,progress:l,isUploaded:o,isUploading:m,files:i,isError:r,errors:t}},M=()=>{const e=I();return s.useSelector(e,t=>t.context.user,(t,n)=>(t&&JSON.stringify(t))===(n&&JSON.stringify(n)))},se=()=>{const{isLoading:e,isAuthenticated:t}=A(),n=M();return E.useMemo(()=>({isLoading:e,isAuthenticated:t,user:n}),[e,t,n])},ne=()=>E.useContext(P).auth.client.backendUrl.replace("/v1/auth",""),oe=e=>{const[t,n]=E.useState(!0);E.useEffect(()=>{n(!1)},[]);const u=E.useContext(P);return new Proxy({},{get(h,d){return y.encodeQueryParameters(`${u.auth.client.backendUrl}/signin/provider/${d}`,y.rewriteRedirectTo(t?void 0:u.auth.client.clientUrl,e))}})},re=(e,t)=>{const n=typeof e=="string"?e:void 0,u=typeof e!="string"?e:t,h=x(),d=E.useMemo(()=>y.createResetPasswordMachine(h.auth.client),[h]),a=s.useInterpret(d),S=s.useSelector(a,i=>i.matches("requesting")),m=s.useSelector(a,i=>i.context.error),o=s.useSelector(a,i=>i.matches("idle.error")),r=s.useSelector(a,i=>i.matches("idle.success"));return{resetPassword:(i,g=u)=>y.resetPasswordPromise(a,typeof i=="string"?i:n,g),isLoading:S,isSent:r,isError:o,error:m}},ce=(e,t)=>{const n=typeof e=="string"?e:void 0,u=typeof e!="string"?e:t,h=x(),d=E.useMemo(()=>y.createSendVerificationEmailMachine(h.auth.client),[h]),a=s.useInterpret(d),S=s.useSelector(a,i=>i.matches({idle:"error"})),m=s.useSelector(a,i=>i.matches({idle:"success"})),o=s.useSelector(a,i=>i.context.error),r=s.useSelector(a,i=>i.matches("requesting"));return{sendEmail:(i,g=u)=>y.sendVerificationEmailPromise(a,typeof i=="string"?i:n,g),isLoading:r,isSent:m,isError:S,error:o}},ie=()=>{const e=I(),t=()=>y.signInAnonymousPromise(e),n=s.useSelector(e,m=>m.context.errors.authentication||null,(m,o)=>(m==null?void 0:m.error)===(o==null?void 0:o.error)),u=s.useSelector(e,m=>m.matches({authentication:{authenticating:"anonymous"}})),h=s.useSelector(e,m=>m.matches({authentication:"signedIn"})),d=s.useSelector(e,m=>m.matches({authentication:{signedOut:"failed"}})),a=s.useSelector(e,m=>m.context.user,(m,o)=>(m==null?void 0:m.id)===(o==null?void 0:o.id));return{accessToken:s.useSelector(e,m=>m.context.accessToken.value),error:n,isError:d,isLoading:u,isSuccess:h,signInAnonymous:t,user:a}},ue=(e,t,n)=>{const u=I(),h=(c,f)=>y.signInEmailPasswordPromise(u,typeof c=="string"?c:e,typeof f=="string"?f:t),d=c=>y.signInMfaTotpPromise(u,typeof c=="string"?c:n),a=s.useSelector(u,c=>c.context.user,(c,f)=>(c==null?void 0:c.id)===(f==null?void 0:f.id)),S=s.useSelector(u,c=>c.context.accessToken.value),m=s.useSelector(u,c=>c.context.errors.authentication||null,(c,f)=>(c==null?void 0:c.error)===(f==null?void 0:f.error)),o=s.useSelector(u,c=>c.matches({authentication:"signedIn"})),r=s.useSelector(u,c=>c.matches({authentication:{authenticating:"password"}}),(c,f)=>c===f),l=s.useSelector(u,c=>c.matches({authentication:{signedOut:"noErrors"},registration:{incomplete:"needsEmailVerification"}}),(c,f)=>c===f),i=s.useSelector(u,c=>c.matches({authentication:{signedOut:"needsMfa"}}),(c,f)=>c===f),g=s.useSelector(u,c=>c.matches({authentication:{signedOut:"failed"}}),(c,f)=>c===f),p=s.useSelector(u,c=>c.context.mfa);return{accessToken:S,error:m,isError:g,isLoading:r,isSuccess:o,needsEmailVerification:l,needsMfaOtp:i,mfa:p,sendMfaOtp:d,signInEmailPassword:h,user:a}};function ae(e,t){const n=typeof e=="string"?e:void 0,u=typeof e=="string"?t:e,h=I(),d=(r,l=u)=>y.signInEmailPasswordlessPromise(h,typeof r=="string"?r:n,l),a=s.useSelector(h,r=>r.context.errors.registration||null,(r,l)=>(r==null?void 0:r.error)===(l==null?void 0:l.error)),S=s.useSelector(h,r=>r.matches("registration.passwordlessEmail")),m=s.useSelector(h,r=>r.matches("registration.incomplete.needsEmailVerification")),o=s.useSelector(h,r=>r.matches("registration.incomplete.failed"));return{signInEmailPasswordless:d,isLoading:S,isSuccess:m,isError:o,error:a}}const le=()=>{const e=I(),t=o=>y.signInEmailSecurityKeyPromise(e,o),n=s.useSelector(e,o=>o.context.user,(o,r)=>(o==null?void 0:o.id)===(r==null?void 0:r.id)),u=s.useSelector(e,o=>o.context.accessToken.value),h=s.useSelector(e,o=>o.context.errors.authentication||null,(o,r)=>(o==null?void 0:o.error)===(r==null?void 0:r.error)),d=s.useSelector(e,o=>o.matches({authentication:"signedIn"})),a=s.useSelector(e,o=>o.matches({authentication:{authenticating:"securityKeyEmail"}}),(o,r)=>o===r),S=s.useSelector(e,o=>o.matches({authentication:{signedOut:"noErrors"},registration:{incomplete:"needsEmailVerification"}}),(o,r)=>o===r),m=s.useSelector(e,o=>o.matches({authentication:{signedOut:"failed"}}),(o,r)=>o===r);return{accessToken:u,error:h,isError:m,isLoading:a,isSuccess:d,needsEmailVerification:S,signInEmailSecurityKey:t,user:n}};function de(e){const t=I(),[n,u]=E.useState(""),h=(l,i=e)=>(u(l),y.signInSmsPasswordlessPromise(t,l,i)),d=async(...l)=>{if(l.length===2){const[g,p]=l;return y.signInSmsPasswordlessOtpPromise(t,g,p)}const[i]=l;return y.signInSmsPasswordlessOtpPromise(t,n,i)},a=s.useSelector(t,l=>l.context.errors.registration||null,(l,i)=>(l==null?void 0:l.error)===(i==null?void 0:i.error)),S=s.useSelector(t,l=>l.matches("registration.passwordlessSms")||l.matches("registration.passwordlessSmsOtp")),m=s.useSelector(t,l=>l.matches("authentication.signedIn")),o=s.useSelector(t,l=>l.matches("registration.incomplete.needsOtp")),r=s.useSelector(t,l=>l.matches("registration.incomplete.failed"));return{signInSmsPasswordless:h,sendOtp:d,isLoading:S,isSuccess:m,needsOtp:o,isError:r,error:a}}const me=(e=!1)=>{const t=I(),n=d=>y.signOutPromise(t,typeof d=="boolean"?d:e),u=s.useSelector(t,d=>d.matches({authentication:{signedOut:"success"}}),(d,a)=>d===a),h=s.useSelector(t,d=>d.context.errors.signout||null,(d,a)=>(d==null?void 0:d.error)===(a==null?void 0:a.error));return{signOut:n,isSuccess:u,error:h}},he=(e,t,n)=>{const u=typeof e=="string"?e:void 0,h=typeof t=="string"?t:void 0,d=n||(typeof e!="string"?e:void 0),a=I(),S=s.useSelector(a,c=>!!c.context.errors.registration),m=s.useSelector(a,c=>c.context.errors.registration||null,(c,f)=>(c==null?void 0:c.error)===(f==null?void 0:f.error)),o=s.useSelector(a,c=>c.matches("registration.emailPassword")),r=s.useSelector(a,c=>c.matches("registration.incomplete.needsEmailVerification")),l=s.useSelector(a,c=>c.matches({authentication:"signedIn",registration:"complete"})),i=(c,f=h,_=d)=>y.signUpEmailPasswordPromise(a,typeof c=="string"?c:u,f,_),g=s.useSelector(a,c=>c.context.user,(c,f)=>(c==null?void 0:c.id)===(f==null?void 0:f.id));return{accessToken:s.useSelector(a,c=>c.context.accessToken.value),error:m,isError:S,isLoading:o,isSuccess:l,needsEmailVerification:r,signUpEmailPassword:i,user:g}},ge=e=>{const t=I(),n=s.useSelector(t,r=>!!r.context.errors.registration),u=s.useSelector(t,r=>r.context.errors.registration||null,(r,l)=>(r==null?void 0:r.error)===(l==null?void 0:l.error)),h=s.useSelector(t,r=>r.matches("registration.securityKey")),d=s.useSelector(t,r=>r.matches("registration.incomplete.needsEmailVerification")),a=s.useSelector(t,r=>r.matches({authentication:"signedIn",registration:"complete"})),S=(r,l=e)=>y.signUpEmailSecurityKeyPromise(t,r,l),m=s.useSelector(t,r=>r.context.user,(r,l)=>(r==null?void 0:r.id)===(l==null?void 0:l.id));return{accessToken:s.useSelector(t,r=>r.context.accessToken.value),error:u,isError:n,isLoading:h,isSuccess:a,needsEmailVerification:d,signUpEmailSecurityKey:S,user:m}},L=()=>{const e=I();return s.useSelector(e,t=>{var n;return(n=t.context.user)==null?void 0:n.avatarUrl},(t,n)=>t===n)},Se=L,N=()=>{const e=I();return s.useSelector(e,t=>{var n;return(n=t.context.user)==null?void 0:n.defaultRole},(t,n)=>t===n)},pe=N,R=()=>{const e=I();return s.useSelector(e,t=>{var n;return(n=t.context.user)==null?void 0:n.displayName},(t,n)=>t===n)},fe=R,D=()=>{const e=I();return s.useSelector(e,t=>{var n;return(n=t.context.user)==null?void 0:n.email},(t,n)=>t===n)},Ee=D,ye=()=>{const e=I();return s.useSelector(e,t=>{var n;return(n=t.context.user)==null?void 0:n.id},(t,n)=>t===n)},V=()=>{const e=I();return s.useSelector(e,t=>{var n;return(n=t.context.user)==null?void 0:n.isAnonymous},(t,n)=>t===n)},Ie=V,xe=()=>{const e=I();return s.useSelector(e,t=>{var n;return(n=t.context.user)==null?void 0:n.locale},(t,n)=>t===n)},Pe=()=>{const e=I();return s.useSelector(e,t=>{var n;return t.matches("authentication.signedIn")?((n=t.context.user)==null?void 0:n.roles)||[]:[]})};exports.NhostClient=J;exports.NhostReactContext=P;exports.NhostReactProvider=Q;exports.SignedIn=$;exports.SignedOut=B;exports.useAccessToken=k;exports.useAddSecurityKey=G;exports.useAuthInterpreter=I;exports.useAuthLoading=Y;exports.useAuthenticated=W;exports.useAuthenticationStatus=A;exports.useAvatarUrl=Se;exports.useChangeEmail=z;exports.useChangePassword=X;exports.useConfigMfa=Z;exports.useDecodedAccessToken=C;exports.useDefaultRole=pe;exports.useDisplayName=fe;exports.useEmail=Ee;exports.useFileUpload=b;exports.useFileUploadItem=T;exports.useHasuraClaim=ee;exports.useHasuraClaims=O;exports.useIsAnonymous=Ie;exports.useMultipleFilesUpload=te;exports.useNhostAuth=se;exports.useNhostBackendUrl=ne;exports.useNhostClient=x;exports.useProviderLink=oe;exports.useResetPassword=re;exports.useSendVerificationEmail=ce;exports.useSignInAnonymous=ie;exports.useSignInEmailPassword=ue;exports.useSignInEmailPasswordless=ae;exports.useSignInEmailSecurityKey=le;exports.useSignInSmsPasswordless=de;exports.useSignOut=me;exports.useSignUpEmailPassword=he;exports.useSignUpEmailSecurityKeyEmail=ge;exports.useUserAvatarUrl=L;exports.useUserData=M;exports.useUserDefaultRole=N;exports.useUserDisplayName=R;exports.useUserEmail=D;exports.useUserId=ye;exports.useUserIsAnonymous=V;exports.useUserLocale=xe;exports.useUserRoles=Pe;
//# sourceMappingURL=index.cjs.js.map
