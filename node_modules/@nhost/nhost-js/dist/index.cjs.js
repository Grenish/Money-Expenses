"use strict";var v=Object.defineProperty;var m=(t,e,r)=>e in t?v(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r;var o=(t,e,r)=>(m(t,typeof e!="symbol"?e+"":e,r),r);Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const E=require("@nhost/hasura-auth-js"),_=require("axios"),y=require("graphql"),$=require("@nhost/hasura-storage-js"),N=t=>t&&typeof t=="object"&&"default"in t?t:{default:t},T=N(_),G=/^((?<protocol>http[s]?):\/\/)?(?<host>localhost)(:(?<port>(\d+|__\w+__)))?$/;function g(t,e){const{backendUrl:r,subdomain:n,region:a}=t;if(r)return`${r}/v1/${e}`;if(!n)throw new Error("Either `backendUrl` or `subdomain` must be set.");const s=n.match(G);if(s!=null&&s.groups){const{protocol:c="http",host:u,port:i=1337}=s.groups,l=F(e);return l||`${c}://${u}:${i}/v1/${e}`}if(!a)throw new Error('`region` must be set when using a `subdomain` other than "localhost".');return`https://${n}.${e}.${a}.nhost.run/v1`}function H(){return typeof window<"u"}function L(){return typeof process<"u"&&process.env}function F(t){return H()||!L()?null:process.env[`NHOST_${t.toUpperCase()}_URL`]}function p(t){const e="subdomain"in t||"backendUrl"in t?g(t,"auth"):t.authUrl;if(!e)throw new Error("Please provide `subdomain` or `authUrl`.");return new E.HasuraAuthClient({url:e,...t})}function A(t){const e="subdomain"in t||"backendUrl"in t?g(t,"functions"):t.functionsUrl;if(!e)throw new Error("Please provide `subdomain` or `functionsUrl`.");return new b({url:e,...t})}class b{constructor(e){o(this,"url");o(this,"instance");o(this,"accessToken");o(this,"adminSecret");const{url:r,adminSecret:n}=e;this.url=r,this.accessToken=null,this.adminSecret=n,this.instance=T.default.create({baseURL:r})}async call(e,r,n){const a={...this.generateAccessTokenHeaders(),...n==null?void 0:n.headers};let s;try{s=await this.instance.post(e,r,{...n,headers:a})}catch(c){if(c instanceof Error)return{res:null,error:c}}return s?{res:s,error:null}:{res:null,error:new Error("Unable to make post request to funtion")}}setAccessToken(e){if(!e){this.accessToken=null;return}this.accessToken=e}generateAccessTokenHeaders(){return this.adminSecret?{"x-hasura-admin-secret":this.adminSecret}:this.accessToken?{Authorization:`Bearer ${this.accessToken}`}:{}}}function w(t){const e="subdomain"in t||"backendUrl"in t?g(t,"graphql"):t.graphqlUrl;if(!e)throw new Error("Please provide `subdomain` or `graphqlUrl`.");return new S({url:e,...t})}class S{constructor(e){o(this,"url");o(this,"instance");o(this,"accessToken");o(this,"adminSecret");const{url:r,adminSecret:n}=e;this.url=r,this.accessToken=null,this.adminSecret=n,this.instance=T.default.create({baseURL:r})}async request(e,r,n){const a={...this.generateAccessTokenHeaders(),...n==null?void 0:n.headers,"Accept-Encoding":"*"};try{const s="",u=(await this.instance.post("",{operationName:s||void 0,query:typeof e=="string"?e:y.print(e),variables:r},{...n,headers:a})).data,{data:i}=u;return u.errors?{data:null,error:u.errors}:typeof i!="object"||Array.isArray(i)||i===null?{data:null,error:new Error("incorrect response data from GraphQL server")}:{data:i,error:null}}catch(s){return s instanceof Error?{data:null,error:s}:(console.error(s),{data:null,error:new Error("Unable to get do GraphQL request")})}}getUrl(){return this.url}setAccessToken(e){if(!e){this.accessToken=null;return}this.accessToken=e}generateAccessTokenHeaders(){return this.adminSecret?{"x-hasura-admin-secret":this.adminSecret}:this.accessToken?{Authorization:`Bearer ${this.accessToken}`}:{}}}function U(t){const e="subdomain"in t||"backendUrl"in t?g(t,"storage"):t.storageUrl;if(!e)throw new Error("Please provide `subdomain` or `storageUrl`.");return new $.HasuraStorageClient({url:e,...t})}const j=t=>new q(t);class q{constructor({refreshIntervalTime:e,clientStorageGetter:r,clientStorageSetter:n,clientStorage:a,clientStorageType:s,autoRefreshToken:c,autoSignIn:u,adminSecret:i,devTools:l,start:C=!0,...d}){o(this,"auth");o(this,"storage");o(this,"functions");o(this,"graphql");o(this,"_adminSecret");o(this,"devTools");this.auth=p({refreshIntervalTime:e,clientStorageGetter:r,clientStorageSetter:n,clientStorage:a,clientStorageType:s,autoRefreshToken:c,autoSignIn:u,start:C,...d}),this.storage=U({adminSecret:i,...d}),this.functions=A({adminSecret:i,...d}),this.graphql=w({adminSecret:i,...d}),this.auth.client.onStart(()=>{const k=this.auth.getAccessToken();this.storage.setAccessToken(k),this.functions.setAccessToken(k),this.graphql.setAccessToken(k),this.auth.onAuthStateChanged((h,f)=>{h==="SIGNED_OUT"&&(this.storage.setAccessToken(void 0),this.functions.setAccessToken(void 0),this.graphql.setAccessToken(void 0))}),this.auth.onTokenChanged(h=>{const f=h==null?void 0:h.accessToken;this.storage.setAccessToken(f),this.functions.setAccessToken(f),this.graphql.setAccessToken(f)})}),this._adminSecret=i,this.devTools=l}get adminSecret(){return this._adminSecret}set adminSecret(e){this._adminSecret=e,this.storage.setAdminSecret(e)}}exports.NhostClient=q;exports.NhostFunctionsClient=b;exports.NhostGraphqlClient=S;exports.createAuthClient=p;exports.createFunctionsClient=A;exports.createGraphqlClient=w;exports.createNhostClient=j;exports.createStorageClient=U;
//# sourceMappingURL=index.cjs.js.map
